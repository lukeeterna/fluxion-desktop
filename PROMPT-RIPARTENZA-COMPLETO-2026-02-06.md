# PROMPT RIPARTENZA - FLUXION Sessione 2026-02-06 (POMERIGGIO)

> **Data**: 2026-02-06 (Sessione Pomeridiana)
> **Stato**: 90% - Comunicazione da perfezionare
> **Branch**: `master`
> **Commit**: `902bd81`

---

## üèõÔ∏è VISIONE: I 3 PILASTRI (Da Leggere Prima)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FLUXION - I 3 PILASTRI                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üì± COMUNICAZIONE      üéØ MARKETING        ‚öôÔ∏è GESTIONE          ‚îÇ
‚îÇ  WhatsApp + Voice      Loyalty + Pacchetti  Calendario + Schede ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚Üí Sostituisce l'operatore        ‚Üí PMI non hanno tempo        ‚îÇ
‚îÇ  ‚Üí 24/7 automatico                ‚Üí Zero-cost marketing         ‚îÇ
‚îÇ  ‚Üí Vantaggio competitivo          ‚Üí Automazione completa        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**REGOLA**: I 3 pilastri devono essere PERFETTI. Questo √® il cuore del prodotto.

---

## üìö FILE DI SISTEMA (Riferimento Obbligatorio)

| File | Scopo | Stato |
|------|-------|-------|
| `CLAUDE.md` | I 3 pilastri, task, comandi | ‚úÖ Aggiornato |
| `PRD-FLUXION-COMPLETE.md` | Funzionalit√† dettagliate | ‚úÖ Aggiornato v1.0 |

**‚ö†Ô∏è LEGGERE SEMPRE `CLAUDE.md` PRIMA** - Contiene la visione dei 3 pilastri.

---

## ‚úÖ COSA C'√à GI√Ä (Non rifare)

### üì± Comunicazione (Parziale)
- ‚úÖ Voice Agent "Sara" - 5 layer pipeline
- ‚úÖ WAITLIST intent + business logic completa
- ‚úÖ WhatsApp Business base integration
- ‚úÖ Setup Wizard con `nome_attivita`, `whatsapp_number`

### üéØ Marketing (Base OK)
- ‚úÖ Database Loyalty: `is_vip`, `loyalty_visits`, `consenso_whatsapp`
- ‚úÖ UI Pacchetti: `PacchettiAdmin.tsx` (creazione pacchetti)
- ‚úÖ UI Loyalty: `LoyaltyProgress.tsx` (tessera timbri)
- ‚úÖ Hooks: `use-loyalty.ts` (API complete)

### ‚öôÔ∏è Gestione (Completa)
- ‚úÖ Calendario + Booking state machine
- ‚úÖ 3 Schede verticali complete (Odontoiatrica, Fisioterapia, Estetica)
- ‚úÖ Fatturazione XML

---

## üî¥ COSA MANCA (Task Prioritarie)

### 1. WhatsApp Pacchetti Selettivo (CRITICO)
**Dove**: Integrare in `PacchettiAdmin.tsx` o nuovo componente

**Flusso Operatore:**
1. Crea pacchetto personalizzato (servizi + sconto % libero) ‚úÖ GI√Ä FATTO
2. **NUOVO**: Seleziona filtro destinatari:
   - Tutti i clienti (con `consenso_whatsapp = true`)
   - Solo VIP (`is_vip = 1`)
   - Solo VIP 3+ stelle (`is_vip = 1 AND loyalty_visits >= 3`)
3. **NUOVO**: Invio WhatsApp con template
4. **NUOVO**: Rate limiting 60 msg/ora + tracking

**Template WhatsApp:**
```
Ciao {nome}! üéÅ

Abbiamo pensato a te: {nome_pacchetto}
‚ú® {servizi_inclusi} servizi
üí∞ Solo ‚Ç¨{prezzo_scontato} invece di ‚Ç¨{prezzo_originale}
‚è∞ Valido per {validita_giorni} giorni

Prenota ora rispondendo a questo messaggio!
{nome_attivita}
```

### 2. Voice Agent Greeting Dinamico
- Leggere `nome_attivita` da impostazioni DB
- Modificare greeting: "Buongiorno, sono Sara di {nome_attivita}"
- File: `voice-agent/src/main.py` o config

### 3. E2E Testing
- Fix PATH `e2e-tests/playwright.config.ts`
- Test smoke + critical su iMac

### 4. Build Produzione (SOLO a fine sviluppo)
- Verificare su iMac
- Tag v0.8.0

---

## üéØ SCENARI PROSSIMA SESSIONE

### Scenario A: Completa Comunicazione (Consigliato - 2-3 ore)
```
WhatsApp Pacchetti UI ‚Üí Voice Greeting ‚Üí E2E ‚Üí Build ‚Üí v0.8.0
```
**Risultato**: I 3 pilastri sono PERFETTI. Pronto per vendita.

### Scenario B: Scheda Parrucchiere (3-4 giorni)
```
Scheda Parrucchiere completa ‚Üí Test ‚Üí Build
```
**Risultato**: +1 verticale completo. Pilastri gi√† OK.

---

## üìÅ FILE CHIAVE DA MODIFICARE

```
# DA MODIFICARE (Task 1 - WhatsApp Pacchetti)
src/components/loyalty/PacchettiAdmin.tsx
  ‚îî‚îÄ‚îÄ Aggiungere: sezione "Invia via WhatsApp"
  ‚îî‚îÄ‚îÄ Aggiungere: select filtri (Tutti/VIP/VIP 3+)
  ‚îî‚îÄ‚îÄ Aggiungere: preview template
  ‚îî‚îÄ‚îÄ Aggiungere: bottone invio con rate limiting

src/hooks/use-loyalty.ts o nuovo use-whatsapp-marketing.ts
  ‚îî‚îÄ‚îÄ Aggiungere: hook per invio WhatsApp selettivo

src-tauri/src/commands/
  ‚îî‚îÄ‚îÄ Aggiungere: comando Tauri per invio WhatsApp pacchetti

# DA MODIFICARE (Task 2 - Voice Greeting)
voice-agent/src/main.py o config.py
  ‚îî‚îÄ‚îÄ Modificare: caricare nome_attivita da DB all'avvio
  ‚îî‚îÄ‚îÄ Modificare: usare nome_attivita in tutti i greeting
```

---

## üîß COMANDI RAPIDO RIPARTENZA

```bash
# 1. Verifica stato (MacBook)
cd /Volumes/MontereyT7/FLUXION
git status
npm run type-check

# 2. Sync iMac
ssh imac "cd '/Volumes/MacSSD - Dati/fluxion' && git pull origin master"

# 3. Test Rust (iMac)
ssh imac "cd '/Volumes/MacSSD - Dati/fluxion/src-tauri' && export PATH='/Users/gianlucadistasi/.cargo/bin:$PATH' && cargo test --lib"

# 4. Build FINALE (SOLO a fine sviluppo, iMac)
# ssh imac "cd '/Volumes/MacSSD - Dati/fluxion' && export PATH='/Users/gianlucadistasi/.cargo/bin:/usr/local/bin:$PATH' && npm run tauri build"
```

---

## üí¨ PROMPT PER RIPARTENZA

Copia e incolla questo prompt:

```
Ciao, sono il CTO di FLUXION. Proseguiamo lo sviluppo.

VISIONE (leggere CLAUDE.md sezione "I 3 PILASTRI"):
I 3 pilastri (Comunicazione, Marketing, Gestione) devono essere PERFETTI.
Sono il cuore del prodotto e il vantaggio competitivo per le PMI.

STATO ATTUALE:
- Comunicazione: 90% (Voice OK, WhatsApp base OK, manca invio pacchetti)
- Marketing: 80% (Loyalty OK, pacchetti OK, manca invio WhatsApp selettivo)
- Gestione: 95% (3 schede complete, 5 placeholder)

DA COMPLETARE PRIORITARIO:
1. WhatsApp Pacchetti Selettivo (da integrare in PacchettiAdmin.tsx)
   - Filtri: Tutti/VIP/VIP 3+ stelle
   - Template con nome_attivita
   - Rate limiting 60 msg/ora

2. Voice Agent Greeting Dinamico (usare nome_attivita da DB)

3. E2E Testing ‚Üí Build Finale v0.8.0

FILE RIFERIMENTO:
- CLAUDE.md (I 3 pilastri, visione prodotto)
- PRD-FLUXION-COMPLETE.md (Sezione 3.6 Loyalty)

AMBIENTE:
- MacBook: /Volumes/MontereyT7/FLUXION (dev)
- iMac: /Volumes/MacSSD - Dati/fluxion (build, solo a fine)
- Repo: lukeeterna/fluxion-desktop

Procedi con WhatsApp Pacchetti Selettivo.
```

---

## ‚úÖ CHECKLIST CHIUSURA SESSIONE

### Prima di chiudere:
- [ ] I 3 pilastri funzionano correttamente?
- [ ] WhatsApp Pacchetti invia con filtri corretti?
- [ ] Voice Agent usa nome attivit√†?
- [ ] Test passano (54/54 Rust, TypeScript clean)?
- [ ] Commit e push

### Build Finale (solo quando tutto OK):
- [ ] E2E tests passano
- [ ] Build su iMac OK
- [ ] Tag v0.8.0
- [ ] Test su macOS e Windows

---

*Prompt generato: 2026-02-06*
*Versione: 2.0 (Allineato con Visione 3 Pilastri)*
*Stato: Pronto per ripartenza*
