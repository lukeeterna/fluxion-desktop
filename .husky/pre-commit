#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Fluxion Pre-Commit Checks..."

# 1. Rust formatting (optional if cargo not available)
echo "âš™ï¸  Formatting Rust..."
if command -v cargo >/dev/null 2>&1; then
  cd src-tauri && cargo fmt --check
  if [ $? -ne 0 ]; then
    echo "âŒ Rust non formattato. Eseguo cargo fmt..."
    cargo fmt
    cd ..
    git add src-tauri/
    echo "âœ… Rust formattato automaticamente"
  else
    cd ..
    echo "âœ… Rust giÃ  formattato"
  fi
else
  echo "âš ï¸  cargo non disponibile, skip Rust formatting check"
fi

# 2. TypeScript check
echo "ğŸ“˜ Type-checking TypeScript..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ ERRORE TypeScript. Fix e riprova."
  exit 1
fi

# 3. Lint
echo "ğŸ” Linting..."
npm run lint:fix
git add .

echo "âœ… Pre-commit checks PASSED"
